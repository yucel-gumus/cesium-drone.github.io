(()=>{"use strict";var e={175:(e,t,i)=>{i.d(t,{E:()=>l,l:()=>o}),Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NzgwODc5Zi05YWU4LTRmZmEtYTExNy0xYjk3MmI4MTgwZjAiLCJpZCI6ODYyNTEsImlhdCI6MTY0ODAzNzA5N30.OlPs1LDNpW8ZuFrR6cpJIiC7wIagyE6sK-LS_n1gmuo";const o=new Cesium.Viewer("cesiumContainer",{shouldAnimate:!0,infoBox:!1,terrain:Cesium.Terrain.fromWorldTerrain(),selectionIndicator:!1,shadows:!0,baseLayerPicker:!1,navigationHelpButton:!1,animation:!1,timeline:!0,fullscreenButton:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,projectionPicker:!1});o.cesiumWidget.creditContainer.style.display="none",o.scene.fog.enabled=!1,o.scene.globe.enableLighting=!0,o.scene.globe.depthTestAgainstTerrain=!0,o.scene.screenSpaceCameraController.minimumZoomDistance=10,o.scene.screenSpaceCameraController.maximumZoomDistance=1e3;const n=Cesium.Cartesian3.fromDegrees(40.293544977054204,40.61760805958316,1),r=Cesium.Math.toRadians(135),a=new Cesium.HeadingPitchRoll(r,0,0),s=Cesium.Transforms.headingPitchRollQuaternion(n,a),l=o.entities.add({name:"Drone",position:n,orientation:s,model:{uri:"./CesiumDrone.glb",heightReference:Cesium.HeightReference.RELATIVE_TO_GROUND,minimumPixelSize:256,maximumScale:10,scale:2,runAnimations:!1}});o.scene.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(40.293544977054204,40.61760805958316,101),orientation:{heading:r,pitch:Cesium.Math.toRadians(-20),roll:0},duration:5,complete:function(){o.trackedEntity=l}})}},t={};function i(o){var n=t[o];if(void 0!==n)return n.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,i),r.exports}i.d=(e,t)=>{for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var o=i(175);new class{constructor(e){this.droneEntity=e,this.circularFlightProperty=null,this.initEventListeners()}initEventListeners(){document.getElementById("createRota").addEventListener("click",(async()=>{const e=JSON.parse(localStorage.getItem("endPosition"));this.removeAllEntitiesExceptFirst(),await this.createRota(e)})),document.getElementById("followRota").addEventListener("click",(()=>{this.followRota()}))}removeAllEntitiesExceptFirst(){const e=o.l.entities.values;for(let t=e.length-1;t>=1;t--)o.l.entities.remove(e[t])}async createRota(e){const t=new Cesium.Cartesian3(e.x,e.y,e.z),i=Cesium.Cartographic.fromCartesian(t),o=Cesium.Math.toDegrees(i.longitude),n=Cesium.Math.toDegrees(i.latitude);await this.computeCircularFlight(o,n,.03,t)}async computeCircularFlight(e,t,i,o){const n=Cesium.JulianDate.now(),r=Cesium.JulianDate.addSeconds(n,360,new Cesium.JulianDate);this.setupClock(n,r);const a=this.generateCircularPositions(e,t,i,o),s=await this.clampPositionsToTerrain(a);this.createCircularFlightProperty(s,n,r),this.addRouteVisualization(s)}setupClock(e,t){o.l.clock.startTime=e.clone(),o.l.clock.stopTime=t.clone(),o.l.clock.currentTime=e.clone(),o.l.clock.multiplier=1}generateCircularPositions(e,t,i,o){const n=Array.from({length:7},((o,n)=>{const r=Cesium.Math.toRadians(360*n/7);return Cesium.Cartographic.fromDegrees(e+i*Math.cos(r),t+i*Math.sin(r))})),r=Cesium.Cartographic.fromCartesian(o);return[r,...n,r]}async clampPositionsToTerrain(e){return(await Cesium.sampleTerrainMostDetailed(o.l.terrainProvider,e)).map((e=>Cesium.Cartesian3.fromRadians(e.longitude,e.latitude,e.height+1e3)))}createCircularFlightProperty(e,t,i){this.circularFlightProperty=new Cesium.SampledPositionProperty;const o=Cesium.JulianDate.secondsDifference(i,t);e.forEach(((i,n)=>{const r=Cesium.JulianDate.addSeconds(t,n/(e.length-1)*o,new Cesium.JulianDate);this.circularFlightProperty.addSample(r,i)}))}addRouteVisualization(e){e.forEach(((t,i)=>{const o=0===i||i===e.length-1?Cesium.Color.RED:Cesium.Color.YELLOW;this.addPointEntity(t,o,i)})),this.addPathEntity(e)}addPointEntity(e,t,i){o.l.entities.add({id:`point_${i}`,position:e,point:{pixelSize:8,color:Cesium.Color.TRANSPARENT,outlineColor:t,outlineWidth:3}})}addPathEntity(e){o.l.entities.add({id:"path_",polyline:{positions:e,width:5,material:new Cesium.PolylineGlowMaterialProperty({glowPower:.2,color:Cesium.Color.YELLOW}),clampToGround:!1}})}followRota(){if(!this.circularFlightProperty)return void console.log("Rota oluşturulmamış. Önce rotayı oluşturun.");const e=o.l.clock.startTime,t=o.l.clock.stopTime;this.setupClockForAnimation(e,t);const i=this.droneEntity;i.position=this.circularFlightProperty,i.orientation=new Cesium.VelocityOrientationProperty(this.circularFlightProperty),i.path={resolution:1,material:new Cesium.PolylineGlowMaterialProperty({glowPower:.2,color:Cesium.Color.BLACK}),width:10},o.l.trackedEntity=i,i.position.setInterpolationOptions({interpolationDegree:2,interpolationAlgorithm:Cesium.HermitePolynomialApproximation}),this.animateDrone(i,t)}setupClockForAnimation(e,t){o.l.clock.startTime=e.clone(),o.l.clock.stopTime=t.clone(),o.l.clock.currentTime=e.clone(),o.l.clock.multiplier=10,o.l.timeline.zoomTo(e,t)}animateDrone(e,t){let i,n=!1;o.l.clock.onTick.addEventListener((()=>{const r=o.l.clock.currentTime,a=e.position.getValue(r);a&&(i=a),Cesium.JulianDate.compare(r,t)>=0&&!n&&(this.completeFlight(e,i),n=!0)}))}completeFlight(e,t){if(o.l.clock.shouldAnimate=!0,e.model.runAnimations=!0,t){e.position=new Cesium.ConstantPositionProperty(t);const i=new Cesium.HeadingPitchRoll(0,0,0),o=Cesium.Transforms.headingPitchRollQuaternion(t,i);e.orientation=new Cesium.ConstantProperty(o)}}}(o.E)})();